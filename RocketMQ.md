# RocketMQ

## offical site
https://rocketmq.apache.org/    

https://github.com/apache/rocketmq

## Go SDK

RocketMQ 4.X https://github.com/apache/rocketmq-client-go   

RocketMQ 5.X https://github.com/apache/rocketmq-clients/golang


## Installtion
### namesrv Setting
```properties
rocketmqHome=/Users/aqi/Downloads/rocketmq-all-5.1.3-bin-release
kvConfigPath=/Users/aqi/namesrv/kvConfig.json
configStorePath=/Users/aqi/namesrv/namesrv.properties
productEnvName=center
clusterTest=false
orderMessageEnable=false
returnOrderTopicConfigToBroker=true
clientRequestThreadPoolNums=8
defaultThreadPoolNums=16
clientRequestThreadPoolQueueCapacity=50000
defaultThreadPoolQueueCapacity=10000
scanNotActiveBrokerInterval=5000
unRegisterBrokerQueueCapacity=3000
supportActingMaster=false
enableAllTopicList=true
enableTopicList=true
notifyMinBrokerIdChanged=false
enableControllerInNamesrv=false
needWaitForService=false
waitSecondsForService=45
bindAddress=0.0.0.0
listenPort=9876
serverWorkerThreads=8
serverCallbackExecutorThreads=0
serverSelectorThreads=3
serverOnewaySemaphoreValue=256
serverAsyncSemaphoreValue=64
serverChannelMaxIdleTimeSeconds=120
serverSocketSndBufSize=0
serverSocketRcvBufSize=0
writeBufferHighWaterMark=0
writeBufferLowWaterMark=0
serverSocketBacklog=1024
serverPooledByteBufAllocatorEnable=true
useEpollNativeSelector=false
clientWorkerThreads=4
clientCallbackExecutorThreads=8
clientOnewaySemaphoreValue=65535
clientAsyncSemaphoreValue=65535
connectTimeoutMillis=3000
channelNotActiveInterval=60000
clientChannelMaxIdleTimeSeconds=120
clientSocketSndBufSize=0
clientSocketRcvBufSize=0
clientPooledByteBufAllocatorEnable=false
clientCloseSocketIfTimeout=true
useTLS=false
socksProxyConfig={}
writeBufferHighWaterMark=0
writeBufferLowWaterMark=0
disableCallbackExecutor=false
disableNettyWorkerGroup=false
```

### broker setting
```properties
brokerConfigPath=
rocketmqHome=/Users/aqi/Downloads/rocketmq-all-5.1.3-bin-release
namesrvAddr=
listenPort=6888
brokerIP1=192.168.20.140
brokerIP2=192.168.20.140
recoverConcurrently=false
brokerPermission=6
defaultTopicQueueNums=8
autoCreateTopicEnable=true
clusterTopicEnable=true
brokerTopicEnable=true
autoCreateSubscriptionGroup=true
messageStorePlugIn=
msgTraceTopicName=RMQ_SYS_TRACE_TOPIC
traceTopicEnable=false
sendMessageThreadPoolNums=4
putMessageFutureThreadPoolNums=4
pullMessageThreadPoolNums=32
litePullMessageThreadPoolNums=32
ackMessageThreadPoolNums=3
processReplyMessageThreadPoolNums=32
queryMessageThreadPoolNums=16
adminBrokerThreadPoolNums=16
clientManageThreadPoolNums=32
consumerManageThreadPoolNums=32
loadBalanceProcessorThreadPoolNums=32
heartbeatThreadPoolNums=8
recoverThreadPoolNums=32
endTransactionThreadPoolNums=24
flushConsumerOffsetInterval=5000
flushConsumerOffsetHistoryInterval=60000
rejectTransactionMessage=false
fetchNameSrvAddrByDnsLookup=false
fetchNamesrvAddrByAddressServer=false
sendThreadPoolQueueCapacity=10000
putThreadPoolQueueCapacity=10000
pullThreadPoolQueueCapacity=100000
litePullThreadPoolQueueCapacity=100000
ackThreadPoolQueueCapacity=100000
replyThreadPoolQueueCapacity=10000
queryThreadPoolQueueCapacity=20000
clientManagerThreadPoolQueueCapacity=1000000
consumerManagerThreadPoolQueueCapacity=1000000
heartbeatThreadPoolQueueCapacity=50000
endTransactionPoolQueueCapacity=100000
adminBrokerThreadPoolQueueCapacity=10000
loadBalanceThreadPoolQueueCapacity=100000
longPollingEnable=true
shortPollingTimeMills=1000
notifyConsumerIdsChangedEnable=true
highSpeedMode=false
commercialBaseCount=1
commercialSizePerMsg=4096
accountStatsEnable=true
accountStatsPrintZeroValues=true
transferMsgByHeap=true
regionId=DefaultRegion
registerBrokerTimeoutMills=24000
sendHeartbeatTimeoutMillis=1000
slaveReadEnable=false
disableConsumeIfConsumerReadSlowly=false
consumerFallbehindThreshold=17179869184
brokerFastFailureEnable=true
waitTimeMillsInSendQueue=200
waitTimeMillsInPullQueue=5000
waitTimeMillsInLitePullQueue=5000
waitTimeMillsInHeartbeatQueue=31000
waitTimeMillsInTransactionQueue=3000
waitTimeMillsInAckQueue=3000
startAcceptSendRequestTimeStamp=0
traceOn=true
enableCalcFilterBitMap=false
rejectPullConsumerEnable=false
expectConsumerNumUseFilter=32
maxErrorRateOfBloomFilter=20
filterDataCleanTimeSpan=86400000
filterSupportRetry=false
enablePropertyFilter=false
compressedRegister=false
forceRegister=true
registerNameServerPeriod=30000
brokerHeartbeatInterval=1000
brokerNotActiveTimeoutMillis=10000
enableNetWorkFlowControl=false
enableBroadcastOffsetStore=true
broadcastOffsetExpireSecond=120
broadcastOffsetExpireMaxSecond=300
popPollingSize=1024
popPollingMapSize=100000
maxPopPollingSize=100000
reviveQueueNum=8
reviveInterval=1000
reviveMaxSlow=3
reviveScanTime=10000
enableSkipLongAwaitingAck=false
reviveAckWaitMs=180000
enablePopLog=false
enablePopBufferMerge=false
popCkStayBufferTime=10000
popCkStayBufferTimeOut=3000
popCkMaxBufferSize=200000
popCkOffsetMaxQueueSize=20000
enablePopBatchAck=false
enableNotifyAfterPopOrderLockRelease=true
realTimeNotifyConsumerChange=true
litePullMessageEnable=true
syncBrokerMemberGroupPeriod=1000
loadBalancePollNameServerInterval=30000
cleanOfflineBrokerInterval=30000
serverLoadBalancerEnable=true
defaultMessageRequestMode=PULL
defaultPopShareQueueNum=-1
transactionTimeOut=6000
transactionCheckMax=15
transactionCheckInterval=30000
transactionOpMsgMaxSize=4096
transactionOpBatchInterval=3000
aclEnable=false
storeReplyMessageEnable=true
enableDetailStat=true
autoDeleteUnusedStats=false
isolateLogEnable=false
forwardTimeout=3000
enableSlaveActingMaster=false
enableRemoteEscape=false
skipPreOnline=false
asyncSendEnable=true
useServerSideResetOffset=false
consumerOffsetUpdateVersionStep=500
delayOffsetUpdateVersionStep=200
lockInStrictMode=false
compatibleWithOldNameSrv=true
enableControllerMode=false
controllerAddr=
fetchControllerAddrByDnsLookup=false
syncBrokerMetadataPeriod=5000
checkSyncStateSetPeriod=5000
syncControllerMetadataPeriod=10000
controllerHeartBeatTimeoutMills=10000
validateSystemTopicWhenUpdateTopic=true
brokerElectionPriority=2147483647
useStaticSubscription=false
metricsExporterType=DISABLE
metricsGrpcExporterTarget=
metricsGrpcExporterHeader=
metricGrpcExporterTimeOutInMills=3000
metricGrpcExporterIntervalInMills=60000
metricLoggingExporterIntervalInMills=10000
metricsPromExporterPort=5557
metricsPromExporterHost=
metricsLabel=
metricsInDelta=false
channelExpiredTimeout=120000
subscriptionExpiredTimeout=600000
estimateAccumulation=true
coldCtrStrategyEnable=false
usePIDColdCtrStrategy=true
cgColdReadThreshold=3145728
globalColdReadThreshold=104857600
fetchNamesrvAddrInterval=10000
bindAddress=0.0.0.0
listenPort=10911
serverWorkerThreads=8
serverCallbackExecutorThreads=0
serverSelectorThreads=3
serverOnewaySemaphoreValue=256
serverAsyncSemaphoreValue=64
serverChannelMaxIdleTimeSeconds=120
serverSocketSndBufSize=0
serverSocketRcvBufSize=0
writeBufferHighWaterMark=0
writeBufferLowWaterMark=0
serverSocketBacklog=1024
serverPooledByteBufAllocatorEnable=true
useEpollNativeSelector=false
clientWorkerThreads=4
clientCallbackExecutorThreads=8
clientOnewaySemaphoreValue=65535
clientAsyncSemaphoreValue=65535
connectTimeoutMillis=3000
channelNotActiveInterval=60000
clientChannelMaxIdleTimeSeconds=120
clientSocketSndBufSize=0
clientSocketRcvBufSize=0
clientPooledByteBufAllocatorEnable=false
clientCloseSocketIfTimeout=true
useTLS=false
socksProxyConfig={}
writeBufferHighWaterMark=0
writeBufferLowWaterMark=0
disableCallbackExecutor=false
disableNettyWorkerGroup=false
storePathRootDir=/Users/aqi/store
storePathCommitLog=
storePathDLedgerCommitLog=
storePathEpochFile=
storePathBrokerIdentity=
readOnlyCommitLogStorePaths=
mappedFileSizeCommitLog=1073741824
compactionMappedFileSize=104857600
compactionCqMappedFileSize=10485760
compactionScheduleInternal=900000
maxOffsetMapSize=104857600
compactionThreadNum=6
enableCompaction=true
mappedFileSizeTimerLog=104857600
timerPrecisionMs=1000
timerRollWindowSlot=172800
timerFlushIntervalMs=1000
timerGetMessageThreadNum=3
timerPutMessageThreadNum=3
timerEnableDisruptor=false
timerEnableCheckMetrics=true
timerInterceptDelayLevel=false
timerMaxDelaySec=259200
timerWheelEnable=true
disappearTimeAfterStart=-1
timerStopEnqueue=false
timerCheckMetricsWhen=05
timerSkipUnknownError=false
timerWarmEnable=false
timerStopDequeue=false
timerCongestNumEachSlot=2147483647
timerMetricSmallThreshold=1000000
timerProgressLogIntervalMs=10000
mappedFileSizeConsumeQueue=6000000
enableConsumeQueueExt=false
mappedFileSizeConsumeQueueExt=50331648
mapperFileSizeBatchConsumeQueue=13800000
bitMapLengthConsumeQueueExt=64
flushIntervalCommitLog=500
commitIntervalCommitLog=200
maxRecoveryCommitlogFiles=30
diskSpaceWarningLevelRatio=90
diskSpaceCleanForciblyRatio=85
useReentrantLockWhenPutMessage=true
flushCommitLogTimed=true
flushIntervalConsumeQueue=1000
cleanResourceInterval=10000
deleteCommitLogFilesInterval=100
deleteConsumeQueueFilesInterval=100
destroyMapedFileIntervalForcibly=120000
redeleteHangedFileInterval=120000
deleteWhen=04
diskMaxUsedSpaceRatio=75
fileReservedTime=72
deleteFileBatchMax=10
putMsgIndexHightWater=600000
maxMessageSize=4194304
checkCRCOnRecover=true
flushCommitLogLeastPages=4
commitCommitLogLeastPages=4
flushLeastPagesWhenWarmMapedFile=4096
flushConsumeQueueLeastPages=2
flushCommitLogThoroughInterval=10000
commitCommitLogThoroughInterval=200
flushConsumeQueueThoroughInterval=60000
maxTransferBytesOnMessageInMemory=262144
maxTransferCountOnMessageInMemory=32
maxTransferBytesOnMessageInDisk=65536
maxTransferCountOnMessageInDisk=8
accessMessageInMemoryMaxRatio=40
messageIndexEnable=true
maxHashSlotNum=5000000
maxIndexNum=20000000
maxMsgsNumBatch=64
messageIndexSafe=false
haListenPort=10912
haSendHeartbeatInterval=5000
haHousekeepingInterval=20000
haTransferBatchSize=32768
haMasterAddress=
haMaxGapNotInSync=268435456
brokerRole=ASYNC_MASTER
flushDiskType=ASYNC_FLUSH
syncFlushTimeout=5000
putMessageTimeout=8000
slaveTimeout=3000
messageDelayLevel=1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h
flushDelayOffsetInterval=10000
cleanFileForciblyEnable=true
warmMapedFileEnable=false
offsetCheckInSlave=false
debugLockEnable=false
duplicationEnable=false
diskFallRecorded=true
osPageCacheBusyTimeOutMills=1000
defaultQueryMaxNum=32
transientStorePoolEnable=false
transientStorePoolSize=5
fastFailIfNoBufferInStorePool=false
enableDLegerCommitLog=false
dLegerGroup=
dLegerPeers=
dLegerSelfId=
preferredLeaderId=
enableBatchPush=false
enableScheduleMessageStats=true
enableLmq=false
enableMultiDispatch=false
maxLmqConsumeQueueNum=20000
enableScheduleAsyncDeliver=false
scheduleAsyncDeliverMaxPendingLimit=2000
scheduleAsyncDeliverMaxResendNum2Blocked=3
maxBatchDeleteFilesNum=50
dispatchCqThreads=10
dispatchCqCacheNum=4096
enableAsyncReput=true
recheckReputOffsetFromCq=false
maxTopicLength=127
autoMessageVersionOnTopicLen=true
travelCqFileNumWhenGetMessage=1
correctLogicMinOffsetSleepInterval=1
correctLogicMinOffsetForceInterval=300000
mappedFileSwapEnable=true
commitLogForceSwapMapInterval=43200000
commitLogSwapMapInterval=3600000
commitLogSwapMapReserveFileNum=100
logicQueueForceSwapMapInterval=43200000
logicQueueSwapMapInterval=3600000
cleanSwapedMapInterval=300000
logicQueueSwapMapReserveFileNum=20
searchBcqByCacheEnable=true
dispatchFromSenderThread=false
wakeCommitWhenPutMessage=true
wakeFlushWhenPutMessage=false
enableCleanExpiredOffset=false
maxAsyncPutMessageRequests=5000
pullBatchMaxMessageCount=160
totalReplicas=1
inSyncReplicas=1
minInSyncReplicas=1
allAckInSyncStateSet=false
enableAutoInSyncReplicas=false
haFlowControlEnable=false
maxHaTransferByteInSecond=104857600
haMaxTimeSlaveNotCatchup=15000
syncMasterFlushOffsetWhenStartup=false
maxChecksumRange=1073741824
replicasPerDiskPartition=1
logicalDiskSpaceCleanForciblyThreshold=0.8
maxSlaveResendLength=268435456
syncFromLastFile=false
asyncLearner=false
maxConsumeQueueScan=20000
sampleCountThreshold=5000
coldDataFlowControlEnable=false
coldDataScanEnable=false
dataReadAheadEnable=false
timerColdDataCheckIntervalMs=60000
sampleSteps=32
accessMessageInMemoryHotRatio=26
enableBuildConsumeQueueConcurrently=false
batchDispatchRequestThreadPoolNums=16
```

### Proxy Setting

Config Path: /path/to/rocketmq-all-5.1.3-bin-release/conf/rmq-proxy.json   


```json
{
  "rocketMQClusterName": "orderCluster",
  "namesrvAddr": "127.0.0.1:19876;127.0.0.1:29876;127.0.0.1:39876",
  "grpcServerPort": 8081, 
  "remotingListenPort": 8080
}
```


- rocketMQClusterName 设置集群名
- namesrvAddr 设置namesrv地址
- grpcServerPort 设置GRPC监听端口并开启GRPC协议
- remotingListenPort 设置remoting监听端口并且开启remoting监听
